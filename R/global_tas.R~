# Name		: global.tas
# Description	: Computes the spatial average of a field.
# Author 	: Abdelkader Mezghani, METNO
# contact 	: abdelkaderm@met.no
# Last Update	: 21-03-2013
# require	: zoo 
# input		: a zoo field object / 3 dimensional field with dimensions (time,lon,lat)

global.tas <- function(x) {
# Get dimensions
d <- attr(x,"dims")
# Get latitude values
lat <- attr(x,"lat")
# index att
ind <- index(x)
# average over longitudes
x <- t(x)
dim(x) <- c(d[1],d[2]*d[3])
x1 <- colMeans(x)
dim(x1) <- c(d[2],d[3])
# average over latitudes using weigted mean
z <- zoo(x = rep(NA,d[3]),order.by=ind)
for (t in 1:d[3]) z[t] <- sum(cos(pi*lat/180)*x1[,t])/sum(cos(pi*lat/180))
return(z)
invisible(z)
}
